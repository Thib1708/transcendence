{% load static %}

<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>{% block title %}{% endblock %}</title>
		<link rel="stylesheet" href="{% static 'main/main.css' %}">
		{% block css %}{% endblock %}
	</head>
	<body>
		<header>
			<nav class="header-menu">
				<a href="{% url 'home' %}" class="menu-link">Home</a>
				{% if request.user.is_authenticated %}
					<a href="{% url 'pong' %}" class="menu-link">Pong</a>
					<a href="{% url 'chat' %}" class="menu-link">Chat</a>
					<a href="{% url 'users' %}" class="menu-link">Users</a>
				{% endif %}
				<p class="menu-link">|</p>
				{% if request.user.is_authenticated %}
					<a href="{% url 'sign_out' %}" class="menu-link">Sign out</a>
					<a href="{% url 'profile_me' %}" class="menu-link-right">
						{{ request.user.username }}
						<img src={{ request.user.photo.url }} alt="profile picture" width="60" height="60">
					</a>
					<a href="{% url 'notifications' %}" class="menu-link-right">
						<img src="{% static 'main/img/notifications.png' %}" alt="notifications" width="50" height="50">
						<span class="notification-count" id="notification-count">{{ request.user.nbNewNotifications }}</span>
					</a>
				{% else %}
					<a href="{% url 'sign_in' %}" class="menu-link">Sign in</a>
					<a href="{% url 'sign_up' %}" class="menu-link">Sign up</a>
				{% endif %}
			</nav>
			{% block header %}{% endblock %}
		</header>
		
		<main>
			{% block content %}{% endblock %}
		</main>
		
		<footer>
			{% block footer %}{% endblock %}
		</footer>
	</body>

	<script>
		var socket = new WebSocket('ws://' + window.location.host + '/ws/notifications/');
		
		socket.onmessage = function(e) {
			var data = JSON.parse(e.data);
			var message = data['message'];
		
			// Update the notification count
			document.getElementById('notification-count').textContent = parseInt(document.getElementById('notification-count').textContent) + 1;
		};
	</script>
</html>

